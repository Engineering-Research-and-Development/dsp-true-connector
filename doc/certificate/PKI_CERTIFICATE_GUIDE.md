# DSP TRUE Connector - PKI & Certificate Management Guide

> **Complete guide for PKI infrastructure, certificate generation, and renewal**

---

## âš ï¸ IMPORTANT: Development vs Production Certificates

> **WARNING: The certificates generated by the scripts in this guide are self-signed and intended for DEVELOPMENT and TESTING purposes ONLY.**

### ğŸš« DO NOT Use Self-Signed Certificates in Production

The certificate generation scripts (`generate-certificates.cmd` / `generate-certificates.sh`) create a self-signed PKI infrastructure. While this is convenient for development and testing, **self-signed certificates must NOT be used in production environments** for the following reasons:

- âŒ **No External Trust**: Self-signed certificates are not trusted by default by browsers or client applications
- âŒ **No Certificate Validation**: Cannot verify the authenticity of the certificate issuer
- âŒ **Security Risk**: Vulnerable to man-in-the-middle attacks without proper trust establishment
- âŒ **Compliance Issues**: Fails regulatory and industry compliance requirements (PCI DSS, SOC 2, etc.)
- âŒ **No Revocation**: Lacks proper certificate revocation mechanisms (CRL/OCSP from trusted CA)

### âœ… Production Certificate Requirements

For production deployments, you **must** obtain certificates from a trusted Certificate Authority (CA):

**Recommended Options:**

1. **Public Certificate Authorities**
   - Let's Encrypt (free, automated, 90-day certificates)
   - DigiCert, Sectigo, GlobalSign (commercial CAs)
   - Organizations with established trust chains

2. **Private/Enterprise Certificate Authority**
   - Internal CA infrastructure for organizational use
   - Must be properly distributed and trusted by all clients
   - Requires robust key management and operational procedures

3. **Cloud Provider Certificate Services**
   - AWS Certificate Manager (ACM)
   - Azure Key Vault with Certificates
   - Google Cloud Certificate Authority Service

### ğŸ“‹ This Guide's Scope

This guide covers:
- âœ… **Development/Testing**: Creating self-signed certificates for local development
- âœ… **PKI Concepts**: Understanding 3-tier architecture and certificate management
- âœ… **Certificate Operations**: Generation, renewal, verification, and troubleshooting

This guide does NOT cover:
- âŒ Production CA integration
- âŒ Commercial certificate procurement
- âŒ Enterprise PKI deployment

For production certificate deployment, refer to your chosen CA's documentation or consult with security professionals.

---

## Table of Contents

1. [Overview](#overview)
2. [3-Tier PKI Architecture](#3-tier-pki-architecture)
3. [Certificate Hierarchy](#certificate-hierarchy)
4. [Certificate Files](#certificate-files)
5. [Prerequisites](#prerequisites)
6. [Generating Certificates](#generating-certificates)
7. [Certificate Verification](#certificate-verification)
8. [Trust Model](#trust-model)
9. [Troubleshooting](#troubleshooting)

---

## Overview

The **DSP TRUE Connector** uses a robust **3-tier Public Key Infrastructure (PKI)** to secure TLS communication between connectors, services, and storage systems. This guide provides comprehensive information on understanding, generating, and managing certificates for the entire infrastructure.

### Why PKI Matters

- **Mutual Authentication**: Both parties verify each other's identity
- **Data Encryption**: All communication is encrypted end-to-end
- **Data Integrity**: Tamper detection through digital signatures
- **Non-repudiation**: Cryptographic proof of message origin
- **Trust Management**: Hierarchical trust model with centralized control

### Key Features

- **3-tier certificate hierarchy** (Root CA â†’ Intermediate CA â†’ Server Certificates)
- **Automated certificate generation** scripts (Windows & Linux)
- **Flexible renewal process** for individual or all certificates
- **Multiple certificate formats** (PKCS12 for Java, PEM for others)
- **Subject Alternative Names (SANs)** for hostname flexibility
- **Industry-standard algorithms** (RSA 2048-bit, SHA-256)

> **ğŸ”’ Security Reminder**: This guide describes self-signed certificate generation for **development and testing only**. Production environments require certificates from trusted Certificate Authorities. See the warning section above for details.

---

## 3-Tier PKI Architecture

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROOT CA (Tier 1)                        â”‚
â”‚                                                            â”‚
â”‚  â€¢ Self-signed certificate                                 â”‚
â”‚  â€¢ Validity: 10 years (3650 days)                          â”‚
â”‚  â€¢ Algorithm: RSA 2048-bit                                 â”‚
â”‚  â€¢ File: dsp-root-ca.p12                                   â”‚
â”‚  â€¢ Status: OFFLINE after initial setup                     â”‚
â”‚  â€¢ Purpose: Ultimate trust anchor                          â”‚
â”‚                                                            â”‚
â”‚  Distinguished Name:                                       â”‚
â”‚  CN=DSP Root CA, OU=Security, O=DSP True Connector,        â”‚
â”‚  L=Belgrade, ST=Serbia, C=RS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ signs
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              INTERMEDIATE CA (Tier 2)                      â”‚
â”‚                                                            â”‚
â”‚  â€¢ Signed by Root CA                                       â”‚
â”‚  â€¢ Validity: 5 years (1825 days)                           â”‚
â”‚  â€¢ Algorithm: RSA 2048-bit                                 â”‚
â”‚  â€¢ File: dsp-intermediate-ca.p12                           â”‚
â”‚  â€¢ Status: ONLINE for operational use                      â”‚
â”‚  â€¢ Purpose: Signs server certificates                      â”‚
â”‚                                                            â”‚
â”‚  Distinguished Name:                                       â”‚
â”‚  CN=DSP Intermediate CA, OU=Security,                      â”‚
â”‚  O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ signs
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             SERVER CERTIFICATES (Tier 3)                   â”‚
â”‚                                                            â”‚
â”‚  â€¢ Signed by Intermediate CA                               â”‚
â”‚  â€¢ Validity: 1 year (365 days)                             â”‚
â”‚  â€¢ Algorithm: RSA 2048-bit                                 â”‚
â”‚  â€¢ Purpose: Secure individual services                     â”‚
â”‚                                                            â”‚
â”‚  Components:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Connector A (connector-a.p12)                    â”‚      â”‚
â”‚  â”‚ â€¢ Format: PKCS12                                 â”‚      â”‚
â”‚  â”‚ â€¢ CN: connector-a                                â”‚      â”‚
â”‚  â”‚ â€¢ SANs: localhost, connector-a, 127.0.0.1        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Connector B (connector-b.p12)                    â”‚      â”‚
â”‚  â”‚ â€¢ Format: PKCS12                                 â”‚      â”‚
â”‚  â”‚ â€¢ CN: connector-b                                â”‚      â”‚
â”‚  â”‚ â€¢ SANs: localhost, connector-b, 127.0.0.1        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ MinIO (private.key + public.crt)                 â”‚      â”‚
â”‚  â”‚ â€¢ Format: PEM                                    â”‚      â”‚
â”‚  â”‚ â€¢ CN: minio                                      â”‚      â”‚
â”‚  â”‚ â€¢ SANs: localhost, minio, 127.0.0.1              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ UI-A (ui-a-cert.key + ui-a-fullchain.crt)        â”‚      â”‚
â”‚  â”‚ â€¢ Format: PEM with fullchain                     â”‚      â”‚
â”‚  â”‚ â€¢ CN: ui-a                                       â”‚      â”‚
â”‚  â”‚ â€¢ SANs: localhost, ui-a, 127.0.0.1               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ UI-B (ui-b-cert.key + ui-b-fullchain.crt)        â”‚      â”‚
â”‚  â”‚ â€¢ Format: PEM with fullchain                     â”‚      â”‚
â”‚  â”‚ â€¢ CN: ui-b                                       â”‚      â”‚
â”‚  â”‚ â€¢ SANs: localhost, ui-b, 127.0.0.1               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TRUSTSTORE (dsp-truststore.p12)           â”‚
â”‚                                                            â”‚
â”‚  Contains:                                                 â”‚
â”‚  â€¢ Intermediate CA certificate (primary trust anchor)      â”‚
â”‚  â€¢ Root CA certificate (for complete chain validation)     â”‚
â”‚                                                            â”‚
â”‚  Purpose: Verify certificates from other connectors        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why 3-Tier PKI?

#### **Security Benefits**

1. **Root CA Protection**: Root CA private key can be kept offline (air-gapped), minimizing exposure
2. **Compromise Isolation**: If Intermediate CA is compromised, only it needs replacement (Root CA unaffected)
3. **Reduced Attack Surface**: Root CA used rarely (only for signing Intermediate CA)

#### **Operational Benefits**

1. **Scalability**: Issue unlimited server certificates without touching Root CA
2. **Flexibility**: Multiple intermediate CAs for different purposes/regions possible
3. **Easy Revocation**: Revoke/replace Intermediate CA without regenerating entire PKI
4. **Faster Recovery**: Recover from Intermediate CA compromise without full PKI rebuild

#### **Compliance Benefits**

1. **Industry Standard**: Follows PKI best practices (CA/Browser Forum guidelines)
2. **Audit Trail**: Clear separation of duties (root vs operational CA)
3. **Risk Management**: Aligns with security frameworks (ISO 27001, NIST)

### Comparison with 2-Tier PKI

| Aspect | 2-Tier PKI | 3-Tier PKI |
|--------|-----------|-----------|
| **Security** | Root CA must be online | Root CA can be offline |
| **Compromise Recovery** | Full PKI rebuild required | Only Intermediate CA replaced |
| **Scalability** | Limited by Root CA exposure | Unlimited with protected Root |
| **Complexity** | Simpler | More components to manage |
| **Best Practice** | Acceptable for small deployments | Recommended for enterprise |

---

## Certificate Hierarchy

### Certificate Chain Validation

When a TLS connection is established, the certificate chain is validated:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Client receives server certificate             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Server: connector-b.example.com                   â”‚  â”‚
â”‚  â”‚ Certificate: connector-b                          â”‚  â”‚
â”‚  â”‚ Issued by: DSP Intermediate CA                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Validate server certificate signature          â”‚
â”‚  â€¢ Extract Intermediate CA public key from truststore   â”‚
â”‚  â€¢ Verify signature on connector-b certificate          â”‚
â”‚  â€¢ Check certificate validity period                    â”‚
â”‚  â€¢ Verify hostname matches SAN (connector-b)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Validate Intermediate CA certificate           â”‚
â”‚  â€¢ Extract Root CA public key from truststore           â”‚
â”‚  â€¢ Verify signature on Intermediate CA certificate      â”‚
â”‚  â€¢ Check certificate validity period                    â”‚
â”‚  â€¢ Verify BasicConstraints: CA=TRUE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Validate Root CA (trust anchor)                â”‚
â”‚  â€¢ Verify Root CA is self-signed                        â”‚
â”‚  â€¢ Check Root CA is in truststore (trusted)             â”‚
â”‚  â€¢ Verify BasicConstraints: CA=TRUE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                âœ… Certificate Chain Valid
                   TLS Handshake Proceeds
```

### Certificate Properties

#### Root CA Certificate

```
Subject: CN=DSP Root CA, OU=Security, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS
Issuer: CN=DSP Root CA, OU=Security, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS (self-signed)
Validity: 10 years (3650 days)
Key Usage: Certificate Signing, CRL Signing
Basic Constraints: CA:TRUE
Signature Algorithm: SHA256withRSA
Key Algorithm: RSA 2048-bit
```

#### Intermediate CA Certificate

```
Subject: CN=DSP Intermediate CA, OU=Security, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS
Issuer: CN=DSP Root CA, OU=Security, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS
Validity: 5 years (1825 days)
Key Usage: Certificate Signing, CRL Signing
Basic Constraints: CA:TRUE, pathlen:0
Signature Algorithm: SHA256withRSA
Key Algorithm: RSA 2048-bit
```

**Note**: `pathlen:0` prevents the Intermediate CA from signing other CA certificates (only end-entity certificates allowed).

#### Server Certificate (e.g., connector-a)

```
Subject: CN=connector-a, OU=Services, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS
Issuer: CN=DSP Intermediate CA, OU=Security, O=DSP True Connector, L=Belgrade, ST=Serbia, C=RS
Validity: 1 year (365 days)
Key Usage: Digital Signature, Key Encipherment
Extended Key Usage: TLS Web Server Authentication, TLS Web Client Authentication
Basic Constraints: CA:FALSE
Subject Alternative Names:
  - DNS: localhost
  - DNS: connector-a
  - IP: 127.0.0.1
Signature Algorithm: SHA256withRSA
Key Algorithm: RSA 2048-bit
```

---

## Certificate Files

### File Inventory

| Component | File Name | Format | Size | Password Protected | Purpose |
|-----------|-----------|--------|------|-------------------|---------|
| **Root CA** | `dsp-root-ca.p12` | PKCS12 | ~2 KB | âœ… Yes | Root certificate authority |
| **Intermediate CA** | `dsp-intermediate-ca.p12` | PKCS12 | ~3 KB | âœ… Yes | Intermediate certificate authority |
| **Connector A** | `connector-a.p12` | PKCS12 | ~4 KB | âœ… Yes | Connector A server certificate |
| **Connector B** | `connector-b.p12` | PKCS12 | ~4 KB | âœ… Yes | Connector B server certificate |
| **MinIO Key** | `private.key` | PEM | ~2 KB | âŒ No | MinIO private key |
| **MinIO Cert** | `public.crt` | PEM | ~2 KB | âŒ No | MinIO certificate |
| **UI-A Key** | `ui-a-cert.key` | PEM | ~2 KB | âŒ No | UI-A private key |
| **UI-A Cert** | `ui-a-fullchain.crt` | PEM | ~4 KB | âŒ No | UI-A certificate + chain |
| **UI-B Key** | `ui-b-cert.key` | PEM | ~2 KB | âŒ No | UI-B private key |
| **UI-B Cert** | `ui-b-fullchain.crt` | PEM | ~4 KB | âŒ No | UI-B certificate + chain |
| **Truststore** | `dsp-truststore.p12` | PKCS12 | ~3 KB | âœ… Yes | Trusted CA certificates |

### Certificate Formats Explained

#### PKCS12 Format (.p12)

**Used by**: Java applications (Spring Boot connectors)

**Contains**:
- Private key (encrypted)
- Server certificate
- Certificate chain (optional)

**Advantages**:
- Single file for all PKI materials
- Password-protected private key
- Native Java KeyStore support
- Binary format (compact)

**Usage in Spring Boot**:
```properties
spring.ssl.bundle.jks.connector.keystore.location=classpath:certs/connector-a.p12
spring.ssl.bundle.jks.connector.keystore.password=password
spring.ssl.bundle.jks.connector.keystore.type=PKCS12
spring.ssl.bundle.jks.connector.key.alias=connector-a
spring.ssl.bundle.jks.connector.key.password=password
```

**Inspect PKCS12 file**:
```bash
# Windows
keytool -list -v -keystore connector-a.p12 -storepass password

# Linux/macOS
keytool -list -v -keystore connector-a.p12 -storepass password
```

#### PEM Format (.key, .crt, .pem)

**Used by**: Non-Java applications (MinIO, Nginx, Apache)

**Contains**: Separate files for each component
- `.key` - Private key (unencrypted, Base64 encoded)
- `.crt` - Certificate (Base64 encoded)
- `*-fullchain.crt` - Certificate + Intermediate CA (for complete chain)

**Advantages**:
- Human-readable (Base64 text)
- Easy to inspect and edit
- Widely supported across platforms
- Can be easily concatenated for chains

**Usage in Nginx**:
```nginx
ssl_certificate /etc/nginx/ssl/ui-a-fullchain.crt;
ssl_certificate_key /etc/nginx/ssl/ui-a-cert.key;
```

**Usage in MinIO**:
```
/root/.minio/certs/
â”œâ”€â”€ private.key
â””â”€â”€ public.crt
```

**Inspect PEM certificate**:
```bash
openssl x509 -in public.crt -text -noout
```

**Inspect PEM private key**:
```bash
openssl rsa -in private.key -check
```

### Full Chain Certificates

For services like Nginx, a **full chain certificate** is required:

```
ui-a-fullchain.crt contains:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI-A Server Certificate   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Intermediate CA Cert      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This allows clients to validate the entire certificate chain without needing the Intermediate CA certificate separately.

---

## Prerequisites

### Software Requirements

#### Windows

**Required**:
- **Java JDK** 11 or higher (includes `keytool`)
  - Download: https://adoptium.net/
  - Verify: `java -version` and `keytool` in PATH

**Optional but Recommended**:
- **OpenSSL** for Windows
  - Download: https://slproweb.com/products/Win32OpenSSL.html
  - Or use Git Bash (includes OpenSSL)
  - Required for PEM format conversion (MinIO, Nginx)

**Verification**:
```cmd
java -version
keytool
openssl version
```

#### Linux/macOS

**Required**:
- **Java JDK** 11 or higher
  ```bash
  # Ubuntu/Debian
  sudo apt update
  sudo apt install openjdk-17-jdk
  
  # RHEL/CentOS
  sudo yum install java-17-openjdk-devel
  
  # macOS (Homebrew)
  brew install openjdk@17
  ```

- **OpenSSL** (usually pre-installed)
  ```bash
  # Ubuntu/Debian
  sudo apt install openssl
  
  # RHEL/CentOS
  sudo yum install openssl
  
  # macOS
  brew install openssl
  ```

**Verification**:
```bash
java -version
keytool -help
openssl version
```

### Directory Structure

Certificate scripts are located in:
```
dsp-true-connector/
â””â”€â”€ doc/
    â””â”€â”€ certificate/
        â”œâ”€â”€ generate-certificates.cmd    # Windows generation script
        â”œâ”€â”€ generate-certificates.sh     # Linux generation script
        â”œâ”€â”€ renew-certificates.cmd       # Windows renewal script
        â”œâ”€â”€ renew-certificates.sh        # Linux renewal script
        â””â”€â”€ (generated certificates appear here)
```

---

## Generating Certificates

> **âš ï¸ Development/Testing Only**: The following certificate generation process creates **self-signed certificates** suitable only for development and testing environments. **Do NOT use these certificates in production.** For production deployments, obtain certificates from a trusted Certificate Authority.

### Windows Certificate Generation

#### Step 1: Review Configuration (Optional)

Open `generate-certificates.cmd` and review/edit configuration:

```batch
REM Root CA Configuration
set ROOT_VALIDITY=3650                     REM 10 years
set ROOT_PASSWORD=password                 REM Change in production!

REM Intermediate CA Configuration
set INTERMEDIATE_VALIDITY=1825             REM 5 years
set INTERMEDIATE_PASSWORD=password

REM Server Certificate Configuration
set SERVER_VALIDITY=365                    REM 1 year
set SERVER_PASSWORD=password

REM Subject Alternative Names per service
set SAN_CONNECTOR_A=DNS:localhost,DNS:connector-a,IP:127.0.0.1
set SAN_CONNECTOR_B=DNS:localhost,DNS:connector-b,IP:127.0.0.1
set SAN_MINIO=DNS:localhost,DNS:minio,IP:127.0.0.1
set SAN_UI_A=DNS:localhost,DNS:ui-a,IP:127.0.0.1
set SAN_UI_B=DNS:localhost,DNS:ui-b,IP:127.0.0.1
```

#### Step 2: Run Generation Script

```cmd
generate-certificates.cmd
```

**Script Output**:
```
==================================================================
DSP True Connector - Certificate Generation Script
==================================================================

This script will generate:
  1. Root CA (self-signed)
  2. Intermediate CA (signed by Root CA)
  3. Server certificates for connector-a and connector-b
  4. Truststore with Intermediate CA certificate

Configuration:
  - connector-a SANs: DNS:localhost,DNS:connector-a,IP:127.0.0.1
  - connector-b SANs: DNS:localhost,DNS:connector-b,IP:127.0.0.1
  - Key Algorithm: RSA 2048 bits
  - Root CA Validity: 3650 days
  - Intermediate CA Validity: 1825 days
  - Server Cert Validity: 365 days

==================================================================

Press any key to continue...
```

#### Step 3: Verify Generated Certificates

After successful execution, verify the following files exist:

```cmd
dir *.p12
dir *.key
dir *.crt
```

**Expected files**:
- `dsp-root-ca.p12`
- `dsp-intermediate-ca.p12`
- `connector-a.p12`
- `connector-b.p12`
- `dsp-truststore.p12`
- `private.key` (MinIO)
- `public.crt` (MinIO)
- `ui-a-cert.key`, `ui-a-fullchain.crt`
- `ui-b-cert.key`, `ui-b-fullchain.crt`

---

### Linux/macOS Certificate Generation

#### Step 1: Make Script Executable

```bash
chmod +x generate-certificates.sh
```

#### Step 2: Review Configuration (Optional)

Open `generate-certificates.sh` and review/edit configuration:

```bash
# Root CA Configuration
ROOT_VALIDITY=3650                         # 10 years
ROOT_PASSWORD="password"                   # Change in production!

# Intermediate CA Configuration
INTERMEDIATE_VALIDITY=1825                 # 5 years
INTERMEDIATE_PASSWORD="password"

# Server Certificate Configuration
SERVER_VALIDITY=365                        # 1 year
SERVER_PASSWORD="password"

# Subject Alternative Names per service
SAN_CONNECTOR_A="DNS:localhost,DNS:connector-a,IP:127.0.0.1"
SAN_CONNECTOR_B="DNS:localhost,DNS:connector-b,IP:127.0.0.1"
SAN_MINIO="DNS:localhost,DNS:minio,IP:127.0.0.1"
SAN_UI_A="DNS:localhost,DNS:ui-a,IP:127.0.0.1"
SAN_UI_B="DNS:localhost,DNS:ui-b,IP:127.0.0.1"
```

#### Step 3: Run Generation Script

```bash
./generate-certificates.sh
```

**Script Output**:
```
==================================================================
DSP True Connector - Certificate Generation Script
==================================================================

This script will generate:
  1. Root CA (self-signed)
  2. Intermediate CA (signed by Root CA)
  3. Server certificates for connector-a and connector-b
  4. MinIO certificate (PEM format)
  5. UI-A and UI-B certificates (PEM format with fullchain)
  6. Truststore with Intermediate CA certificate

Configuration:
  - connector-a SANs: DNS:localhost,DNS:connector-a,IP:127.0.0.1
  - connector-b SANs: DNS:localhost,DNS:connector-b,IP:127.0.0.1
  - Key Algorithm: RSA 2048 bits
  - Root CA Validity: 3650 days
  - Intermediate CA Validity: 1825 days
  - Server Cert Validity: 365 days

==================================================================

Press Enter to continue...
```

#### Step 4: Verify Generated Certificates

```bash
ls -lh *.p12 *.key *.crt 2>/dev/null
```

**Expected output**:
```
-rw-r--r-- 1 user group 2.1K Nov 26 10:00 connector-a.p12
-rw-r--r-- 1 user group 2.1K Nov 26 10:00 connector-b.p12
-rw-r--r-- 1 user group 2.0K Nov 26 10:00 dsp-intermediate-ca.p12
-rw-r--r-- 1 user group 1.9K Nov 26 10:00 dsp-root-ca.p12
-rw-r--r-- 1 user group 2.2K Nov 26 10:00 dsp-truststore.p12
-rw-r--r-- 1 user group 1.7K Nov 26 10:00 private.key
-rw-r--r-- 1 user group 1.3K Nov 26 10:00 public.crt
-rw-r--r-- 1 user group 1.7K Nov 26 10:00 ui-a-cert.key
-rw-r--r-- 1 user group 2.6K Nov 26 10:00 ui-a-fullchain.crt
-rw-r--r-- 1 user group 1.7K Nov 26 10:00 ui-b-cert.key
-rw-r--r-- 1 user group 2.6K Nov 26 10:00 ui-b-fullchain.crt
```

---

### Generation Process Details

The generation scripts perform the following steps:

#### 1. Generate Root CA (Self-Signed)

The script creates a self-signed Root CA certificate with:
- RSA 2048-bit key pair
- 10-year validity period
- BasicConstraints: CA=TRUE
- KeyUsage: Certificate Signing, CRL Signing

#### 2. Generate Intermediate CA

The script generates the Intermediate CA by:
- Creating a new key pair
- Generating a Certificate Signing Request (CSR)
- Signing the CSR with the Root CA
- Importing the signed certificate back into the keystore

The Intermediate CA includes `pathlen:0` constraint to prevent it from signing other CA certificates.

#### 3. Generate Server Certificates

For each server (connector-a, connector-b, minio, ui-a, ui-b), the script:
- Generates a new RSA 2048-bit key pair
- Creates a Certificate Signing Request (CSR)
- Signs the CSR with the Intermediate CA
- Adds appropriate Subject Alternative Names (SANs)
- Imports the complete certificate chain

#### 4. Create Truststore

The script creates a truststore containing:
- Root CA certificate
- Intermediate CA certificate

This truststore is used by connectors to validate certificates from other connectors.

#### 5. Convert to PEM Format

For services that require PEM format (MinIO, Nginx):
- Extracts the private key from PKCS12 keystore
- Extracts the certificate
- Creates fullchain certificates (certificate + intermediate CA) for Nginx

**Note**: All certificate generation commands are implemented in `generate-certificates.cmd` (Windows) and `generate-certificates.sh` (Linux). Refer to these scripts for exact command syntax.

---

## Certificate Verification

### Verify Certificate Details

#### Windows

```cmd
REM List all certificates in keystore
keytool -list -v -keystore connector-a.p12 -storepass password

REM Check specific certificate
keytool -list -v -keystore connector-a.p12 -storepass password -alias connector-a

REM Check validity period only
keytool -list -v -keystore connector-a.p12 -storepass password | findstr "Valid"

REM Check SANs
keytool -list -v -keystore connector-a.p12 -storepass password | findstr "SubjectAlternativeName"
```

#### Linux/macOS

```bash
# List all certificates
keytool -list -v -keystore connector-a.p12 -storepass password

# Check specific certificate
keytool -list -v -keystore connector-a.p12 -storepass password -alias connector-a

# Check validity period
keytool -list -v -keystore connector-a.p12 -storepass password | grep "Valid"

# Check SANs
keytool -list -v -keystore connector-a.p12 -storepass password | grep -A 5 "SubjectAlternativeName"

# PEM certificate verification
openssl x509 -in public.crt -text -noout
openssl x509 -in public.crt -noout -dates
openssl x509 -in public.crt -noout -subject -issuer
```

### Verify Certificate Chain

#### Verify Chain in PKCS12

```bash
# Export and verify
keytool -list -v -keystore connector-a.p12 -storepass password | grep -E "(Alias|Owner|Issuer)"
```

**Expected output**:
```
Alias name: connector-a
Owner: CN=connector-a, OU=Services, O=DSP True Connector, ...
Issuer: CN=DSP Intermediate CA, OU=Security, O=DSP True Connector, ...
```

#### Verify Chain with OpenSSL

```bash
# Extract certificate
keytool -exportcert -alias connector-a -keystore connector-a.p12 \
  -storepass password -file connector-a-cert.pem

# Extract intermediate CA
keytool -exportcert -alias dsp-intermediate-ca -keystore dsp-intermediate-ca.p12 \
  -storepass password -file intermediate-ca.pem

# Verify chain
openssl verify -CAfile intermediate-ca.pem connector-a-cert.pem
```

### Test TLS Connection

#### Using OpenSSL s_client

```bash
# Test connector TLS
openssl s_client -connect localhost:8080 -showcerts

# With specific CA bundle
openssl s_client -connect localhost:8080 -CAfile dsp-truststore.pem

# Check certificate expiration
echo | openssl s_client -connect localhost:8080 2>/dev/null | \
  openssl x509 -noout -dates
```

#### Using curl

```bash
# Test with system trust store
curl -v https://localhost:8080/actuator/health

# Test with specific CA certificate
curl -v --cacert dsp-truststore.pem https://localhost:8080/actuator/health

# Ignore certificate validation (testing only!)
curl -k https://localhost:8080/actuator/health
```

---

## Trust Model

### Truststore Configuration

The **truststore** (`dsp-truststore.p12`) contains trusted CA certificates:

```
dsp-truststore.p12
â”œâ”€â”€ Intermediate CA Certificate (primary trust anchor)
â””â”€â”€ Root CA Certificate (for complete validation)
```

### Trust Establishment

When Connector A connects to Connector B:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Connector A (Client)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Truststore: dsp-truststore.p12                       â”‚   â”‚
â”‚  â”‚  â€¢ Contains: Intermediate CA + Root CA               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ TLS Handshake
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Connector B (Server)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Keystore: connector-b.p12                            â”‚   â”‚
â”‚  â”‚  â€¢ Contains: connector-b cert + private key          â”‚   â”‚
â”‚  â”‚  â€¢ Certificate signed by: Intermediate CA            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Validation Process:
1. Connector B presents connector-b certificate
2. Connector A extracts Intermediate CA from truststore
3. Connector A verifies connector-b cert signature using Int. CA public key
4. Connector A verifies hostname matches SAN
5. âœ… Trust established, TLS connection proceeds
```

### Mutual TLS (mTLS)

For mutual authentication, both connectors authenticate each other:

```
Connector A                           Connector B
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. ClientHello â†’
                                      â† 2. ServerHello + Cert(B)
3. Verify Cert(B) with truststore
4. ClientCertificate: Cert(A) â†’
                                      5. Verify Cert(A) with truststore
                                      â† 6. Finished
7. Finished â†’
8. âœ… Mutual TLS established
```

**Configuration for mTLS**:
```properties
# Require client certificate
server.ssl.client-auth=need

# Truststore for client certificate validation
spring.ssl.bundle.jks.connector.truststore.location=classpath:certs/dsp-truststore.p12
spring.ssl.bundle.jks.connector.truststore.password=password
```
---

## Troubleshooting

### Common Issues

#### Issue 1: Certificate Expired

**Symptoms**:
```
javax.net.ssl.SSLHandshakeException: PKIX path validation failed: 
java.security.cert.CertPathValidatorException: validity check failed
```

**Solution**:
```bash
# Check expiration
keytool -list -v -keystore connector-a.p12 -storepass password | grep "Valid"

# Regenerate certificates
cd doc/certificate
./generate-certificate.sh  # or .cmd on Windows
```

#### Issue 2: Hostname Verification Failed

**Symptoms**:
```
javax.net.ssl.SSLPeerUnverifiedException: Hostname 'connector-b' not verified
```

**Solution**:
```bash
# Check SANs in certificate
keytool -list -v -keystore connector-b.p12 -storepass password | grep -A 5 "SubjectAlternativeName"

# If hostname missing, regenerate certificate with correct SAN
# Edit generate-certificates.cmd/.sh:
set SAN_CONNECTOR_B=DNS:localhost,DNS:connector-b,DNS:actual-hostname.com,IP:127.0.0.1

# Regenerate certificates
./generate-certificates.sh
```

#### Issue 3: Truststore Doesn't Trust Certificate

**Symptoms**:
```
sun.security.validator.ValidatorException: PKIX path building failed: 
sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
```

**Solution**:
```bash
# Verify truststore contains Intermediate CA
keytool -list -v -keystore dsp-truststore.p12 -storepass password

# If missing, import Intermediate CA
keytool -exportcert -alias dsp-intermediate-ca \
  -keystore dsp-intermediate-ca.p12 -storepass password \
  -file intermediate-ca.crt

keytool -importcert -alias dsp-intermediate-ca \
  -keystore dsp-truststore.p12 -storepass password \
  -file intermediate-ca.crt -noprompt
```

#### Issue 4: Password Mismatch

**Symptoms**:
```
keytool error: java.io.IOException: keystore password was incorrect
```

**Solution**:
```bash
# Try with different password
keytool -list -keystore connector-a.p12 -storepass different_password

# If password unknown, regenerate certificate
./generate-certificates.sh
```

#### Issue 5: Certificate Chain Incomplete

**Symptoms**:
```
SSL handshake fails with "certificate_unknown" alert
```

**Solution**:
```bash
# Export full chain
keytool -exportcert -alias connector-a -keystore connector-a.p12 \
  -storepass password -file connector-a-chain.pem -rfc

# Verify chain links
openssl verify -verbose -CAfile <(cat root-ca.crt intermediate-ca.crt) connector-a.crt
```

#### Issue 6: OpenSSL Not Found (Windows)

**Symptoms**:
```
'openssl' is not recognized as an internal or external command
```

**Solution**:
```cmd
REM Option 1: Install OpenSSL for Windows
REM Download from: https://slproweb.com/products/Win32OpenSSL.html

REM Option 2: Use Git Bash
"C:\Program Files\Git\bin\bash.exe" -c "openssl version"

REM Option 3: Manual PEM conversion using keytool only
keytool -importkeystore -srckeystore minio.p12 -destkeystore minio.jks -deststoretype JKS
```

### Debugging Commands

#### Verbose Certificate Information

```bash
# Full certificate details
keytool -list -v -keystore connector-a.p12 -storepass password

# Specific fields
keytool -list -v -keystore connector-a.p12 -storepass password | \
  grep -E "(Alias|Owner|Issuer|Valid|SubjectAlternativeName)"

# Certificate fingerprint (for manual verification)
keytool -list -keystore connector-a.p12 -storepass password -v | grep -A 2 "Certificate fingerprints"
```

#### Test TLS Connection with Details

```bash
# Detailed TLS handshake
openssl s_client -connect localhost:8080 -showcerts -tlsextdebug

# Check specific TLS version
openssl s_client -connect localhost:8080 -tls1_2

# Check cipher suites
openssl s_client -connect localhost:8080 -cipher 'HIGH:!aNULL:!MD5'
```

#### Java TLS Debug

Enable Java TLS debugging:

```bash
# Linux/macOS
export JAVA_OPTS="-Djavax.net.debug=ssl:handshake:verbose"
java $JAVA_OPTS -jar connector.jar

# Windows
set JAVA_OPTS=-Djavax.net.debug=ssl:handshake:verbose
java %JAVA_OPTS% -jar connector.jar
```

Or in `application.properties`:
```properties
logging.level.javax.net.ssl=DEBUG
```